<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Manager Pro - Professional Edition</title>
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiQnVzaW5lc3MgTWFuYWdlciBQcm8iLCJzaG9ydF9uYW1lIjoiQml6TWFuYWdlciIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjZmZmZmZmIiwidGhlbWVfY29sb3IiOiIjMjU2M2ViIiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owaWFIUjBjRG92TDNkM2R5NTNNeTV2Y21jdk1qQXdNQzl6ZG1jaUlIWnBaWGRDYjNnOUlqQWdNQ0F4TURZZ01UQTJJaUJtYVd4c1BTSWpNalUyTTJWaUlqNDhjbVZqZENCM2FXUjBhRDBpTVRBMklpQm9aV2xuYUhROUlqRXdOaUlpSUhKNFBTSXhNaUlpTHo0OEwzTjJaejQ9IiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjEwNngxMDYifV19">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-solid: #667eea;
            --primary-dark: #5a67d8;
            --secondary: #64748b;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --background: #f8fafc;
            --surface: #ffffff;
            --surface-elevated: #ffffff;
            --border: #e2e8f0;
            --text: #1a202c;
            --text-secondary: #4a5568;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --border-radius: 12px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        [data-theme="dark"] {
            --background: #0f172a;
            --surface: #1e293b;
            --surface-elevated: #334155;
            --border: #334155;
            --text: #f1f5f9;
            --text-secondary: #cbd5e1;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .app-container {
            display: flex;
            height: 100vh;
            position: relative;
        }

        .sidebar {
            width: 280px;
            background: var(--surface);
            border-right: 1px solid var(--border);
            padding: 2rem 1.5rem;
            overflow-y: auto;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 3rem;
            padding: 1rem;
            border-radius: var(--border-radius);
            background-color: var(--surface-elevated);
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            padding: 0 1rem;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            margin-bottom: 0.5rem;
            transition: var(--transition);
            font-weight: 500;
            position: relative;
            overflow: hidden;
        }

        .nav-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 0;
            height: 100%;
            background: var(--primary);
            transition: var(--transition);
            z-index: -1;
        }

        .nav-item:hover::before,
        .nav-item.active::before {
            width: 100%;
        }

        .nav-item:hover,
        .nav-item.active {
            color: white;
            transform: translateX(4px);
        }

        .nav-item .icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
        }

        .main-content {
            flex: 1;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            background: var(--background);
        }

        .header {
            background: var(--surface);
            border-bottom: 1px solid var(--border);
            padding: 1.5rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
            position: relative;
            z-index: 10;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .page-title {
            font-size: 1.875rem;
            font-weight: 700;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .breadcrumb {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .summary-chips {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .chip {
            background: var(--surface-elevated);
            border: 1px solid var(--border);
            padding: 0.75rem 1.25rem;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 600;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .chip::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary-solid);
        }

        .chip.success::before { background: var(--success); }
        .chip.warning::before { background: var(--warning); }
        .chip.danger::before { background: var(--danger); }
        .chip.info::before { background: var(--info); }

        .chip:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            background: var(--background);
        }

        .page {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
        }

        .card:hover {
            box-shadow: var(--shadow-lg);
            transform: translateY(-4px);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 0.875rem;
            font-weight: 600;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
            text-decoration: none;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: var(--transition);
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn.secondary {
            background: var(--secondary);
        }

        .btn.success {
            background: var(--success);
        }

        .btn.warning {
            background: var(--warning);
        }

        .btn.danger {
            background: var(--danger);
        }

        .btn.info {
            background: var(--info);
        }

        .btn.sm {
            padding: 0.5rem 1rem;
            font-size: 0.75rem;
        }

        .btn.lg {
            padding: 1rem 2rem;
            font-size: 1rem;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
            font-size: 0.875rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--surface);
            color: var(--text);
            transition: var(--transition);
            font-size: 0.875rem;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--primary-solid);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
            transform: translateY(-1px);
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
        }

        .table-container {
            background: var(--surface);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow);
            margin-top: 1.5rem;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th,
        .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border);
            font-size: 0.875rem;
        }

        .table th {
            background: var(--surface-elevated);
            font-weight: 600;
            color: var(--text);
            cursor: pointer;
            position: relative;
            transition: var(--transition);
        }

        .table th:hover {
            background: var(--border);
        }

        .table th::after {
            content: '↕️';
            position: absolute;
            right: 0.5rem;
            opacity: 0.5;
        }

        .table tr {
            transition: var(--transition);
        }

        .table tr:hover {
            background: var(--background);
            transform: scale(1.01);
        }

        .table tr.no-hover:hover {
            background: transparent;
            transform: none;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            backdrop-filter: blur(5px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: modalFadeIn 0.3s ease-out;
        }

        @keyframes modalFadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 2rem;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: var(--shadow-lg);
            animation: modalSlideIn 0.3s ease-out;
            position: relative;
        }

        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-50px) scale(0.95); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border);
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            background: var(--danger);
            color: white;
            transform: rotate(90deg);
        }

        .toast {
            position: fixed;
            top: 2rem;
            right: 2rem;
            background: var(--success);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: var(--transition);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            max-width: 400px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast.error {
            background: var(--danger);
        }

        .toast.warning {
            background: var(--warning);
        }

        .toast.info {
            background: var(--info);
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            margin-bottom: 3rem;
        }

        .stat-card {
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            padding: 2rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            background: var(--primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-change {
            font-size: 0.75rem;
            margin-top: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.25rem;
        }

        .stat-change.positive {
            color: var(--success);
        }

        .stat-change.negative {
            color: var(--danger);
        }

        .search-filter {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            align-items: center;
            flex-wrap: wrap;
            background: var(--surface);
            padding: 1.5rem;
            border-radius: var(--border-radius);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
        }

        .search-input {
            flex: 1;
            min-width: 250px;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--background);
            transition: var(--transition);
        }

        .search-input:focus {
            border-color: var(--primary-solid);
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
        }

        .filter-select {
            padding: 0.75rem 1rem;
            border: 1px solid var(--border);
            border-radius: var(--border-radius);
            background: var(--surface);
            min-width: 150px;
            transition: var(--transition);
        }

        .filter-select:focus {
            border-color: var(--primary-solid);
            outline: none;
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0.5rem;
            margin-top: 2rem;
            padding: 1rem;
        }

        .pagination button {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text);
            cursor: pointer;
            border-radius: var(--border-radius);
            transition: var(--transition);
            font-weight: 500;
        }

        .pagination button:hover {
            background: var(--primary-solid);
            color: white;
            transform: translateY(-1px);
        }

        .pagination button.active {
            background: var(--primary-solid);
            color: white;
            border-color: var(--primary-solid);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .file-upload {
            border: 2px dashed var(--border);
            border-radius: var(--border-radius);
            padding: 3rem 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--background);
            position: relative;
            overflow: hidden;
        }

        .file-upload::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.1), transparent);
            transition: var(--transition);
        }

        .file-upload:hover::before {
            left: 100%;
        }

        .file-upload:hover {
            border-color: var(--primary-solid);
            background: rgba(102, 126, 234, 0.05);
            transform: scale(1.02);
        }

        .file-upload.dragover {
            border-color: var(--primary-solid);
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.05);
        }

        .attachment-preview {
            max-width: 120px;
            max-height: 120px;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            box-shadow: var(--shadow);
        }

        .attachment-preview:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-lg);
        }

        .attachment-container {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }

        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .status-paid {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .status-pending {
            background: rgba(245, 158, 11, 0.1);
            color: var(--warning);
            border: 1px solid rgba(245, 158, 11, 0.2);
        }

        .status-overdue {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        .status-draft {
            background: rgba(100, 116, 139, 0.1);
            color: var(--secondary);
            border: 1px solid rgba(100, 116, 139, 0.2);
        }

        .image-viewer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            backdrop-filter: blur(10px);
        }

        .image-viewer img {
            max-width: 90%;
            max-height: 90%;
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
        }

        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            align-items: center;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: var(--border);
            border-radius: 9999px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: var(--primary);
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        .notification-badge {
            position: absolute;
            top: -8px;
            right: -8px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .quick-actions {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            z-index: 100;
        }

        .fab {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary);
            color: white;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .fab:hover {
            transform: scale(1.1);
            box-shadow: 0 25px 50px -12px rgba(102, 126, 234, 0.5);
        }

        .theme-toggle {
            background: var(--surface);
            border: 1px solid var(--border);
            color: var(--text);
            padding: 0.75rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 500;
        }

        .theme-toggle:hover {
            background: var(--primary-solid);
            color: white;
            transform: translateY(-2px);
        }

        .sidebar-toggle {
            display: none;
            background: var(--primary-solid);
            color: white;
            border: none;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1.25rem;
        }

        @media (max-width: 1024px) {
            .sidebar {
                position: fixed;
                left: -280px;
                top: 0;
                height: 100%;
                z-index: 1000;
                transition: var(--transition);
            }

            .sidebar.open {
                left: 0;
            }

            .sidebar-toggle {
                display: block;
            }

            .main-content {
                width: 100%;
            }

            .form-row {
                grid-template-columns: 1fr;
            }

            .dashboard-grid {
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            }

            .search-filter {
                flex-direction: column;
                align-items: stretch;
            }

            .action-buttons {
                flex-direction: column;
            }

            .summary-chips {
                justify-content: center;
            }

            .header {
                padding: 1rem;
            }

            .content {
                padding: 1rem;
            }
        }

        @media (max-width: 640px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 1.5rem;
                margin: 1rem;
            }

            .table-container {
                overflow-x: auto;
            }

            .table {
                min-width: 600px;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--background);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--border);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Animations */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
        }

        .animate-slide-up {
            animation: slideInUp 0.5s ease-out;
        }

        .animate-pulse {
            animation: pulse 2s infinite;
        }

        /* Enhanced Chart Styles */
        .chart-container {
            background: var(--surface);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
        }

        .chart-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text);
        }

        /* Auto-save indicator */
        .auto-save-indicator {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: var(--success);
            color: white;
            padding: 0.75rem 1rem;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 600;
            opacity: 0;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: var(--shadow);
        }

        .auto-save-indicator.show {
            opacity: 1;
        }

        /* Print Styles */
        @media print {
            .sidebar,
            .header,
            .quick-actions,
            .auto-save-indicator {
                display: none !important;
            }

            .main-content {
                width: 100% !important;
            }

            .content {
                padding: 0 !important;
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <nav class="sidebar" id="sidebar">
            <div class="logo">
                <span class="icon">💼</span>
                Business Manager Pro
            </div>
            
            <div class="nav-section">
                <div class="nav-section-title">Dashboard</div>
                <a href="#" class="nav-item active" data-page="dashboard">
                    <span class="icon">📊</span>
                    Dashboard
                </a>
                <a href="#" class="nav-item" data-page="analytics">
                    <span class="icon">📈</span>
                    Analytics
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Operations</div>
                <a href="#" class="nav-item" data-page="inventory">
                    <span class="icon">📦</span>
                    Inventory
                </a>
                <a href="#" class="nav-item" data-page="sales">
                    <span class="icon">💰</span>
                    Sales
                </a>
                <a href="#" class="nav-item" data-page="purchases">
                    <span class="icon">🛒</span>
                    Purchases
                </a>
                <a href="#" class="nav-item" data-page="expenses">
                    <span class="icon">💸</span>
                    Expenses
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Finance</div>
                <a href="#" class="nav-item" data-page="loans">
                    <span class="icon">🏦</span>
                    Loans
                </a>
                <a href="#" class="nav-item" data-page="payables">
                    <span class="icon">📋</span>
                    Payables
                </a>
                <a href="#" class="nav-item" data-page="receivables">
                    <span class="icon">📄</span>
                    Receivables
                </a>
                <a href="#" class="nav-item" data-page="banking">
                    <span class="icon">💳</span>
                    Banking
                </a>
            </div>

            <div class="nav-section">
                <div class="nav-section-title">Reports & Settings</div>
                <a href="#" class="nav-item" data-page="reports">
                    <span class="icon">📊</span>
                    Reports
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <span class="icon">⚙️</span>
                    Settings
                </a>
            </div>
        </nav>

        <main class="main-content">
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" onclick="toggleSidebar()">☰</button>
                    <div>
                        <h1 class="page-title" id="pageTitle">Dashboard</h1>
                        <div class="breadcrumb" id="breadcrumb">Home / Dashboard</div>
                    </div>
                </div>
                
                <div class="summary-chips">
                    <div class="chip success" id="cashChip">
                        <strong>Cash:</strong> PKR 0
                    </div>
                    <div class="chip info" id="bankChip">
                        <strong>Bank:</strong> PKR 0
                    </div>
                    <div class="chip warning" id="payablesChip">
                        <strong>Payables:</strong> PKR 0
                    </div>
                    <div class="chip danger" id="receivablesChip">
                        <strong>Receivables:</strong> PKR 0
                    </div>
                </div>

                <div class="header-actions">
                    <button class="theme-toggle" onclick="toggleTheme()">
                        <span id="themeIcon">🌙</span>
                        <span id="themeText">Dark</span>
                    </button>
                    <button class="btn info" onclick="showBackupModal()">
                        <span>💾</span>
                        Backup
                    </button>
                    <button class="btn success" onclick="showNotifications()">
                        <span>🔔</span>
                        <span class="notification-badge" id="notificationCount">0</span>
                    </button>
                </div>
            </header>

            <div class="content">
                <!-- Dashboard Page -->
                <div class="page active animate-slide-up" id="dashboard">
                    <div class="dashboard-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="totalSales">PKR 0</div>
                            <div class="stat-label">Total Sales</div>
                            <div class="stat-change positive" id="salesChange">
                                <span>↗️</span> +0% from last month
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="totalPurchases">PKR 0</div>
                            <div class="stat-label">Total Purchases</div>
                            <div class="stat-change positive" id="purchasesChange">
                                <span>↗️</span> +0% from last month
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="profit">PKR 0</div>
                            <div class="stat-label">Net Profit</div>
                            <div class="stat-change positive" id="profitChange">
                                <span>↗️</span> +0% from last month
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="lowStockItems">0</div>
                            <div class="stat-label">Low Stock Alert</div>
                            <div class="stat-change" id="stockChange">
                                Items need restocking
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <span>📊</span>
                                    Sales Overview
                                </h2>
                                <button class="btn secondary" onclick="refreshDashboard()">
                                    <span>🔄</span> Refresh
                                </button>
                            </div>
                            <div class="chart-container">
                                <canvas id="salesChart" width="400" height="200"></canvas>
                            </div>
                        </div>

                        <div class="card">
                            <div class="card-header">
                                <h2 class="card-title">
                                    <span>💰</span>
                                    Cash Flow
                                </h2>
                            </div>
                            <div class="chart-container">
                                <canvas id="cashFlowChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>📋</span>
                                Recent Transactions
                            </h2>
                            <div class="action-buttons">
                                <button class="btn" onclick="loadDemoData()">
                                    <span>🎯</span> Load Demo Data
                                </button>
                                <button class="btn secondary" onclick="exportTransactions()">
                                    <span>📤</span> Export
                                </button>
                            </div>
                        </div>
                        
                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('recentTransactions', 0)">Date</th>
                                        <th onclick="sortTable('recentTransactions', 1)">Type</th>
                                        <th onclick="sortTable('recentTransactions', 2)">Description</th>
                                        <th onclick="sortTable('recentTransactions', 3)">Amount</th>
                                        <th onclick="sortTable('recentTransactions', 4)">Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="recentTransactions">
                                    <tr class="no-hover">
                                        <td colspan="6" style="text-align: center; color: var(--text-secondary); padding: 3rem;">
                                            <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">No transactions yet</div>
                                            <div>Click "Load Demo Data" to get started with sample data</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div class="page" id="analytics">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>📈</span>
                                Business Analytics
                            </h2>
                            <div class="action-buttons">
                                <select class="filter-select" id="analyticsDateRange">
                                    <option value="7">Last 7 days</option>
                                    <option value="30">Last 30 days</option>
                                    <option value="90">Last 90 days</option>
                                    <option value="365">Last year</option>
                                </select>
                                <button class="btn" onclick="generateAnalytics()">
                                    <span>🔄</span> Refresh
                                </button>
                            </div>
                        </div>
                        
                        <div class="dashboard-grid">
                            <div class="stat-card">
                                <div class="stat-value" id="avgOrderValue">PKR 0</div>
                                <div class="stat-label">Average Order Value</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="totalCustomers">0</div>
                                <div class="stat-label">Total Customers</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="inventoryTurnover">0x</div>
                                <div class="stat-label">Inventory Turnover</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-value" id="profitMargin">0%</div>
                                <div class="stat-label">Profit Margin</div>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="chart-container">
                                <div class="chart-title">Revenue Trend</div>
                                <canvas id="revenueChart" width="400" height="200"></canvas>
                            </div>
                            <div class="chart-container">
                                <div class="chart-title">Expense Breakdown</div>
                                <canvas id="expenseChart" width="400" height="200"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Inventory Page -->
                <div class="page" id="inventory">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>📦</span>
                                Inventory Management
                            </h2>
                            <div class="action-buttons">
                                <button class="btn" onclick="showInventoryModal()">
                                    <span>➕</span> Add Item
                                </button>
                                <button class="btn secondary" onclick="exportInventoryCSV()">
                                    <span>📤</span> Export CSV
                                </button>
                                <button class="btn info" onclick="importInventoryCSV()">
                                    <span>📥</span> Import CSV
                                </button>
                                <button class="btn warning" onclick="adjustMultipleStock()">
                                    <span>🔢</span> Bulk Adjust
                                </button>
                            </div>
                        </div>
                        
                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="🔍 Search items by name, SKU, or category..." id="inventorySearch" oninput="searchInventory()">
                            <select class="filter-select" id="categoryFilter" onchange="filterInventory()">
                                <option value="">All Categories</option>
                            </select>
                            <select class="filter-select" id="stockFilter" onchange="filterInventory()">
                                <option value="">All Stock Levels</option>
                                <option value="low">⚠️ Low Stock</option>
                                <option value="out">❌ Out of Stock</option>
                                <option value="normal">✅ Normal Stock</option>
                            </select>
                            <button class="btn secondary" onclick="refreshInventory()">
                                <span>🔄</span> Refresh
                            </button>
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>
                                            <input type="checkbox" id="selectAllInventory" onchange="toggleSelectAllInventory()">
                                        </th>
                                        <th onclick="sortTable('inventoryTable', 1)">SKU</th>
                                        <th onclick="sortTable('inventoryTable', 2)">Name</th>
                                        <th onclick="sortTable('inventoryTable', 3)">Category</th>
                                        <th onclick="sortTable('inventoryTable', 4)">Stock</th>
                                        <th onclick="sortTable('inventoryTable', 5)">Cost Price</th>
                                        <th onclick="sortTable('inventoryTable', 6)">Selling Price</th>
                                        <th onclick="sortTable('inventoryTable', 7)">Value</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="inventoryTable">
                                    <tr class="no-hover">
                                        <td colspan="9" style="text-align: center; color: var(--text-secondary); padding: 3rem;">
                                            <div style="font-size: 3rem; margin-bottom: 1rem;">📦</div>
                                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">No inventory items</div>
                                            <div>Add your first inventory item to get started</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination" id="inventoryPagination"></div>
                    </div>
                </div>

                <!-- Sales Page -->
                <div class="page" id="sales">
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">
                                <span>💰</span>
                                Sales Management
                            </h2>
                            <div class="action-buttons">
                                <button class="btn" onclick="showSalesModal()">
                                    <span>➕</span> New Sale
                                </button>
                                <button class="btn secondary" onclick="exportSalesCSV()">
                                    <span>📤</span> Export CSV
                                </button>
                                <button class="btn info" onclick="printSalesReport()">
                                    <span>🖨️</span> Print Report
                                </button>
                                <button class="btn warning" onclick="bulkSalesActions()">
                                    <span>⚡</span> Bulk Actions
                                </button>
                            </div>
                        </div>

                        <div class="search-filter">
                            <input type="text" class="search-input" placeholder="🔍 Search sales by customer, invoice, or items..." id="salesSearch" oninput="searchSales()">
                            <input type="date" class="filter-select" id="salesDateFrom" onchange="filterSales()" placeholder="From Date">
                            <input type="date" class="filter-select" id="salesDateTo" onchange="filterSales()" placeholder="To Date">
                            <select class="filter-select" id="salesStatusFilter" onchange="filterSales()">
                                <option value="">All Status</option>
                                <option value="Paid">✅ Paid</option>
                                <option value="Pending">⏳ Pending</option>
                                <option value="Overdue">⚠️ Overdue</option>
                            </select>
                            <select class="filter-select" id="salesPaymentFilter" onchange="filterSales()">
                                <option value="">All Payment Methods</option>
                                <option value="Cash">💵 Cash</option>
                                <option value="Bank">🏦 Bank</option>
                                <option value="Credit">📝 Credit</option>
                            </select>
                        </div>

                        <div class="table-container">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th onclick="sortTable('salesTable', 0)">Invoice #</th>
                                        <th onclick="sortTable('salesTable', 1)">Date</th>
                                        <th onclick="sortTable('salesTable', 2)">Customer</th>
                                        <th onclick="sortTable('salesTable', 3)">Items</th>
                                        <th onclick="sortTable('salesTable', 4)">Total</th>
                                        <th onclick="sortTable('salesTable', 5)">Payment</th>
                                        <th onclick="sortTable('salesTable', 6)">Status</th>
                                        <th>Image</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="salesTable">
                                    <tr class="no-hover">
                                        <td colspan="9" style="text-align: center; color: var(--text-secondary); padding: 3rem;">
                                            <div style="font-size: 3rem; margin-bottom: 1rem;">💰</div>
                                            <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">No sales recorded</div>
                                            <div>Create your first sale to start tracking revenue</div>
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="pagination" id="salesPagination"></div>
                    </div>
                </div>

                <!-- Additional pages would continue with similar structure... -->
                <!-- For brevity, I'll continue with the key modal and JavaScript sections -->

            </div>
        </main>
    </div>

    <!-- Quick Actions FAB -->
    <div class="quick-actions">
        <button class="fab" onclick="showQuickSale()" title="Quick Sale">💰</button>
        <button class="fab" onclick="showQuickExpense()" title="Quick Expense">💸</button>
        <button class="fab" onclick="showQuickInventory()" title="Quick Inventory">📦</button>
    </div>

    <!-- Modals -->
    <!-- Inventory Modal -->
    <div class="modal" id="inventoryModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>📦</span>
                    <span id="inventoryModalTitle">Add Inventory Item</span>
                </h3>
                <button class="close-btn" onclick="closeModal('inventoryModal')">&times;</button>
            </div>
            <form id="inventoryForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">SKU *</label>
                        <input type="text" class="form-input" id="itemSku" required placeholder="e.g., SHIRT001">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Product Name *</label>
                        <input type="text" class="form-input" id="itemName" required placeholder="e.g., Cotton T-Shirt">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Category *</label>
                        <select class="form-input" id="itemCategory" required>
                            <option value="">Select Category</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Min Stock Alert</label>
                        <input type="number" class="form-input" id="itemMinStock" min="0" placeholder="10">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Cost Price (PKR) *</label>
                        <input type="number" class="form-input" id="itemCostPrice" min="0" step="0.01" required placeholder="500.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Selling Price (PKR) *</label>
                        <input type="number" class="form-input" id="itemSellingPrice" min="0" step="0.01" required placeholder="800.00">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Initial Stock</label>
                        <input type="number" class="form-input" id="itemStock" min="0" placeholder="100">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Unit of Measure</label>
                        <select class="form-input" id="itemUnit">
                            <option value="pcs">Pieces</option>
                            <option value="kg">Kilograms</option>
                            <option value="ltr">Liters</option>
                            <option value="box">Boxes</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Description</label>
                    <textarea class="form-input" id="itemDescription" rows="3" placeholder="Product description..."></textarea>
                </div>
                
                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn secondary" onclick="closeModal('inventoryModal')">
                        <span>✖️</span> Cancel
                    </button>
                    <button type="submit" class="btn">
                        <span>💾</span> Save Item
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Sales Modal -->
    <div class="modal" id="salesModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">
                    <span>💰</span>
                    <span id="salesModalTitle">New Sale</span>
                </h3>
                <button class="close-btn" onclick="closeModal('salesModal')">&times;</button>
            </div>
            <form id="salesForm">
                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Customer Name *</label>
                        <input list="customersList" class="form-input" id="saleCustomer" required placeholder="Enter customer name">
                        <datalist id="customersDatalist"></datalist>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Sale Date *</label>
                        <input type="date" class="form-input" id="saleDate" required>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Items *</label>
                    <div id="saleItems">
                        <div class="sale-item-row" style="display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;">
                            <div style="flex: 2;">
                                <label class="form-label">Product</label>
                                <select class="form-input sale-item-select" required>
                                    <option value="">Select Item</option>
                                </select>
                            </div>
                            <div style="flex: 1;">
                                <label class="form-label">Quantity</label>
                                <input type="number" class="form-input sale-qty" placeholder="1" min="1" required>
                            </div>
                            <div style="flex: 1;">
                                <label class="form-label">Unit Price</label>
                                <input type="number" class="form-input sale-price" placeholder="0.00" min="0" step="0.01" required>
                            </div>
                            <div style="flex: 1;">
                                <label class="form-label">Total</label>
                                <input type="text" class="form-input sale-item-total" readonly placeholder="0.00">
                            </div>
                            <button type="button" class="btn danger" onclick="removeSaleItem(this)">
                                <span>🗑️</span>
                            </button>
                        </div>
                    </div>
                    <button type="button" class="btn secondary" onclick="addSaleItem()">
                        <span>➕</span> Add Item
                    </button>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Subtotal</label>
                        <input type="text" class="form-input" id="saleSubtotal" readonly placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Discount</label>
                        <input type="number" class="form-input" id="saleDiscount" min="0" step="0.01" value="0" oninput="calculateSaleTotal()">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="form-label">Shipping</label>
                        <input type="number" class="form-input" id="saleShipping" min="0" step="0.01" value="0" oninput="calculateSaleTotal()">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Amount</label>
                        <input type="text" class="form-input" id="saleTotal" readonly placeholder="0.00" style="font-weight: bold; font-size: 1.125rem;">
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">Payment Method *</label>
                    <select class="form-input" id="salePaymentMethod" required>
                        <option value="">Select Payment Method</option>
                        <option value="Cash">💵 Cash</option>
                        <option value="Bank">🏦 Bank Transfer</option>
                        <option value="Credit">📝 Credit (Pay Later)</option>
                        <option value="Card">💳 Card Payment</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">Invoice Image/Attachment</label>
                    <div class="file-upload" onclick="document.getElementById('saleAttachment').click()">
                        <div style="font-size: 2rem; margin-bottom: 1rem;">📎</div>
                        <p><strong>Click to upload invoice image</strong></p>
                        <p style="color: var(--text-secondary); font-size: 0.875rem;">Supports JPG, PNG, PDF (Max 5MB)</p>
                        <input type="file" id="saleAttachment" accept="image/*,.pdf" style="display: none;" onchange="handleFilePreview('saleAttachment', 'saleAttachmentPreview')">
                    </div>
                    <div id="saleAttachmentPreview" class="attachment-container"></div>
                </div>

                <div class="form-group">
                    <label class="form-label">Notes</label>
                    <textarea class="form-input" id="saleNotes" rows="3" placeholder="Additional notes for this sale..."></textarea>
                </div>

                <div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
                    <button type="button" class="btn secondary" onclick="closeModal('salesModal')">
                        <span>✖️</span> Cancel
                    </button>
                    <button type="submit" class="btn">
                        <span>💾</span> Save Sale
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Image Viewer -->
    <div class="image-viewer" id="imageViewer" onclick="closeImageViewer()">
        <img id="viewerImage" src="" alt="Document" style="border-radius: var(--border-radius); box-shadow: var(--shadow-lg);">
    </div>

    <!-- Auto-save indicator -->
    <div class="auto-save-indicator" id="autoSaveIndicator">
        <span class="loading"></span>
        Auto-saving...
    </div>

    <!-- Toast notification -->
    <div class="toast" id="toast">
        <span id="toastIcon">✅</span>
        <span id="toastMessage">Success!</span>
    </div>

    <script>
        // Enhanced Database Class with better error handling and performance
        class BusinessDB {
            constructor() {
                this.db = null;
                this.isInitialized = false;
                this.initPromise = this.init();
            }

            async init() {
                if (this.isInitialized) return this.db;
                
                return new Promise((resolve, reject) => {
                    const request = indexedDB.open('BusinessManagerProDB', 3);
                    
                    request.onerror = () => {
                        console.error('Database error:', request.error);
                        reject(request.error);
                    };
                    
                    request.onsuccess = () => {
                        this.db = request.result;
                        this.isInitialized = true;
                        console.log('Database initialized successfully');
                        resolve(this.db);
                    };
                    
                    request.onupgradeneeded = (event) => {
                        const db = event.target.result;
                        console.log('Upgrading database...');
                        
                        const stores = [
                            'inventory', 'sales', 'purchases', 'expenses', 
                            'loans', 'payments', 'transfers', 'attachments', 
                            'settings', 'bankAccounts', 'customers', 'suppliers',
                            'categories', 'notifications'
                        ];
                        
                        stores.forEach(storeName => {
                            if (!db.objectStoreNames.contains(storeName)) {
                                const store = db.createObjectStore(storeName, { 
                                    keyPath: 'id', 
                                    autoIncrement: true 
                                });
                                
                                // Create indexes for better querying
                                switch (storeName) {
                                    case 'inventory':
                                        store.createIndex('sku', 'sku', { unique: true });
                                        store.createIndex('category', 'category');
                                        store.createIndex('name', 'name');
                                        break;
                                    case 'sales':
                                        store.createIndex('customer', 'customer');
                                        store.createIndex('date', 'date');
                                        store.createIndex('invoiceNumber', 'invoiceNumber', { unique: true });
                                        break;
                                    case 'purchases':
                                        store.createIndex('supplier', 'supplier');
                                        store.createIndex('date', 'date');
                                        break;
                                    case 'expenses':
                                        store.createIndex('category', 'category');
                                        store.createIndex('date', 'date');
                                        break;
                                    case 'settings':
                                        store.createIndex('key', 'key', { unique: true });
                                        break;
                                }
                            }
                        });
                    };
                });
            }

            async ensureReady() {
                if (!this.isInitialized) {
                    await this.initPromise;
                }
                return this.db;
            }

            async add(storeName, data) {
                await this.ensureReady();
                data.createdAt = new Date().toISOString();
                data.updatedAt = new Date().toISOString();
                data.id = data.id || this.generateId();
                
                const transaction = this.db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.add(data);
                    request.onsuccess = () => {
                        console.log(`Added to ${storeName}:`, data);
                        resolve(request.result);
                        this.notifyDataChange(storeName, 'add', data);
                    };
                    request.onerror = () => {
                        console.error(`Error adding to ${storeName}:`, request.error);
                        reject(request.error);
                    };
                });
            }

            async update(storeName, data) {
                await this.ensureReady();
                data.updatedAt = new Date().toISOString();
                
                const transaction = this.db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.put(data);
                    request.onsuccess = () => {
                        console.log(`Updated in ${storeName}:`, data);
                        resolve(request.result);
                        this.notifyDataChange(storeName, 'update', data);
                    };
                    request.onerror = () => {
                        console.error(`Error updating in ${storeName}:`, request.error);
                        reject(request.error);
                    };
                });
            }

            async delete(storeName, id) {
                await this.ensureReady();
                const transaction = this.db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.delete(id);
                    request.onsuccess = () => {
                        console.log(`Deleted from ${storeName}:`, id);
                        resolve(request.result);
                        this.notifyDataChange(storeName, 'delete', { id });
                    };
                    request.onerror = () => {
                        console.error(`Error deleting from ${storeName}:`, request.error);
                        reject(request.error);
                    };
                });
            }

            async get(storeName, id) {
                await this.ensureReady();
                const transaction = this.db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.get(id);
                    request.onsuccess = () => resolve(request.result);
                    request.onerror = () => reject(request.error);
                });
            }

            async getAll(storeName) {
                await this.ensureReady();
                const transaction = this.db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.getAll();
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            }

            async search(storeName, indexName, value) {
                await this.ensureReady();
                const transaction = this.db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const index = store.index(indexName);
                
                return new Promise((resolve, reject) => {
                    const request = index.getAll(value);
                    request.onsuccess = () => resolve(request.result || []);
                    request.onerror = () => reject(request.error);
                });
            }

            async clear(storeName) {
                await this.ensureReady();
                const transaction = this.db.transaction([storeName], 'readwrite');
                const store = transaction.objectStore(storeName);
                
                return new Promise((resolve, reject) => {
                    const request = store.clear();
                    request.onsuccess = () => {
                        console.log(`Cleared ${storeName}`);
                        resolve(request.result);
                        this.notifyDataChange(storeName, 'clear');
                    };
                    request.onerror = () => reject(request.error);
                });
            }

            generateId() {
                return Date.now().toString(36) + Math.random().toString(36).substr(2);
            }

            notifyDataChange(storeName, action, data) {
                // Trigger auto-save indicator
                showAutoSave();
                
                // Update real-time data if needed
                if (storeName === 'sales' || storeName === 'purchases' || storeName === 'expenses') {
                    updateSummaryChips();
                }
            }
        }

        // Initialize database
        const db = new BusinessDB();

        // Global application state
        const appState = {
            currentPage: 'dashboard',
            editingItem: null,
            filters: {},
            sorting: { column: -1, direction: 'asc' },
            pagination: { page: 1, size: 50 },
            user: { preferences: {} },
            notifications: [],
            autoSaveEnabled: true
        };

        // Utility Functions
        const utils = {
            formatCurrency(amount, currency = 'PKR') {
                if (isNaN(amount)) return 'PKR 0';
                return new Intl.NumberFormat('en-PK', {
                    style: 'currency',
                    currency: currency,
                    minimumFractionDigits: 0,
                    maximumFractionDigits: 2
                }).format(amount || 0);
            },

            formatDate(date, format = 'short') {
                if (!date) return '-';
                const d = new Date(date);
                if (isNaN(d.getTime())) return '-';
                
                const options = format === 'short' 
                    ? { year: 'numeric', month: 'short', day: 'numeric' }
                    : { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    
                return d.toLocaleDateString('en-US', options);
            },

            generateInvoiceNumber(prefix = 'INV') {
                const date = new Date();
                const year = date.getFullYear().toString().substr(-2);
                const month = (date.getMonth() + 1).toString().padStart(2, '0');
                const day = date.getDate().toString().padStart(2, '0');
                const random = Math.floor(Math.random() * 1000).toString().padStart(3, '0');
                return `${prefix}-${year}${month}${day}-${random}`;
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            validateEmail(email) {
                const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return re.test(email);
            },

            sanitizeInput(input) {
                if (typeof input !== 'string') return input;
                return input.replace(/[<>'"]/g, '');
            },

            calculatePercentageChange(current, previous) {
                if (previous === 0) return current > 0 ? 100 : 0;
                return ((current - previous) / previous) * 100;
            }
        };

        // Toast Notification System
        function showToast(message, type = 'success', duration = 3000) {
            const toast = document.getElementById('toast');
            const toastIcon = document.getElementById('toastIcon');
            const toastMessage = document.getElementById('toastMessage');
            
            const icons = {
                success: '✅',
                error: '❌',
                warning: '⚠️',
                info: 'ℹ️'
            };
            
            toastIcon.textContent = icons[type] || icons.success;
            toastMessage.textContent = message;
            toast.className = `toast show ${type}`;
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        // Auto-save Indicator
        function showAutoSave() {
            if (!appState.autoSaveEnabled) return;
            
            const indicator = document.getElementById('autoSaveIndicator');
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 2000);
        }

        // Navigation System
        function navigateTo(page) {
            // Update active nav item
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-page="${page}"]`)?.classList.add('active');

            // Update page title and breadcrumb
            updatePageHeader(page);

            // Show active page with animation
            document.querySelectorAll('.page').forEach(pageEl => {
                pageEl.classList.remove('active');
            });
            const targetPage = document.getElementById(page);
            if (targetPage) {
                targetPage.classList.add('active', 'animate-slide-up');
                setTimeout(() => targetPage.classList.remove('animate-slide-up'), 500);
            }

            appState.currentPage = page;
            
            // Load page data
            loadPageData(page);
        }

        function updatePageHeader(page) {
            const pageTitle = document.getElementById('pageTitle');
            const breadcrumb = document.getElementById('breadcrumb');
            
            const titles = {
                dashboard: 'Dashboard',
                analytics: 'Analytics',
                inventory: 'Inventory',
                sales: 'Sales',
                purchases: 'Purchases',
                expenses: 'Expenses',
                loans: 'Loans',
                payables: 'Payables',
                receivables: 'Receivables',
                banking: 'Banking',
                reports: 'Reports',
                settings: 'Settings'
            };
            
            const breadcrumbs = {
                dashboard: 'Home / Dashboard',
                analytics: 'Home / Analytics',
                inventory: 'Operations / Inventory',
                sales: 'Operations / Sales',
                purchases: 'Operations / Purchases',
                expenses: 'Operations / Expenses',
                loans: 'Finance / Loans',
                payables: 'Finance / Payables',
                receivables: 'Finance / Receivables',
                banking: 'Finance / Banking',
                reports: 'Reports & Analytics',
                settings: 'Configuration / Settings'
            };
            
            pageTitle.textContent = titles[page] || 'Dashboard';
            breadcrumb.textContent = breadcrumbs[page] || 'Home / Dashboard';
        }

        // Modal System
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                // Focus first input
                const firstInput = modal.querySelector('input, select, textarea');
                if (firstInput) {
                    setTimeout(() => firstInput.focus(), 300);
                }
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                // Reset form
                const form = modal.querySelector('form');
                if (form) {
                    form.reset();
                    // Clear any attachment previews
                    const previews = modal.querySelectorAll('.attachment-container');
                    previews.forEach(preview => preview.innerHTML = '');
                }
                appState.editingItem = null;
            }
        }

        // Enhanced Search and Filter Functions
        const searchFunctions = {
            inventory: utils.debounce(function() {
                const searchTerm = document.getElementById('inventorySearch')?.value.toLowerCase() || '';
                const categoryFilter = document.getElementById('categoryFilter')?.value || '';
                const stockFilter = document.getElementById('stockFilter')?.value || '';
                
                const rows = document.querySelectorAll('#inventoryTable tr:not(.no-hover)');
                
                rows.forEach(row => {
                    const cells = row.querySelectorAll('td');
                    if (cells.length === 0) return;
                    
                    const sku = cells[1]?.textContent.toLowerCase() || '';
                    const name = cells[2]?.textContent.toLowerCase() || '';
                    const category = cells[3]?.textContent || '';
                    const stockText = cells[4]?.textContent || '';
                    
                    let visible = true;
                    
                    // Text search
                    if (searchTerm && !sku.includes(searchTerm) && !name.includes(searchTerm) && !category.toLowerCase().includes(searchTerm)) {
                        visible = false;
                    }
                    
                    // Category filter
                    if (categoryFilter && category !== categoryFilter) {
                        visible = false;
                    }
                    
                    // Stock filter
                    if (stockFilter) {
                        const hasLowStock = stockText.includes('⚠️');
                        const stock = parseInt(stockText.split(' ')[0]) || 0;
                        
                        if (stockFilter === 'low' && !hasLowStock) visible = false;
                        if (stockFilter === 'out' && stock !== 0) visible = false;
                        if (stockFilter === 'normal' && (stock === 0 || hasLowStock)) visible = false;
                    }
                    
                    row.style.display = visible ? '' : 'none';
                });
            }, 300),

            sales: utils.debounce(function() {
                const searchTerm = document.getElementById('salesSearch')?.value.toLowerCase() || '';
                const rows = document.querySelectorAll('#salesTable tr:not(.no-hover)');
                
                rows.forEach(row => {
                    const text = row.textContent.toLowerCase();
                    row.style.display = text.includes(searchTerm) ? '' : 'none';
                });
            }, 300)
        };

        function searchInventory() {
            searchFunctions.inventory();
        }

        function searchSales() {
            searchFunctions.sales();
        }

        function filterInventory() {
            searchFunctions.inventory();
        }

        function filterSales() {
            // Implementation for advanced filtering
            loadSales();
        }

        // Data Loading Functions
        async function loadPageData(page) {
            try {
                switch (page) {
                    case 'dashboard':
                        await loadDashboard();
                        break;
                    case 'analytics':
                        await loadAnalytics();
                        break;
                    case 'inventory':
                        await loadInventory();
                        break;
                    case 'sales':
                        await loadSales();
                        break;
                    case 'purchases':
                        await loadPurchases();
                        break;
                    case 'expenses':
                        await loadExpenses();
                        break;
                    case 'loans':
                        await loadLoans();
                        break;
                    case 'payables':
                        await loadPayables();
                        break;
                    case 'receivables':
                        await loadReceivables();
                        break;
                    case 'banking':
                        await loadBanking();
                        break;
                    case 'reports':
                        await loadReports();
                        break;
                    case 'settings':
                        await loadSettings();
                        break;
                }
            } catch (error) {
                console.error(`Error loading ${page}:`, error);
                showToast(`Error loading ${page} data`, 'error');
            }
        }

        // Dashboard Functions
        async function loadDashboard() {
            try {
                await updateSummaryChips();
                await loadRecentTransactions();
                await updateDashboardStats();
                await renderDashboardCharts();
            } catch (error) {
                console.error('Error loading dashboard:', error);
                showToast('Error loading dashboard data', 'error');
            }
        }

        async function updateSummaryChips() {
            try {
                // Get all financial data
                const [sales, purchases, expenses, loans, transfers, payments, bankAccounts] = await Promise.all([
                    db.getAll('sales'),
                    db.getAll('purchases'),
                    db.getAll('expenses'),
                    db.getAll('loans'),
                    db.getAll('transfers'),
                    db.getAll('payments'),
                    db.getAll('bankAccounts')
                ]);

                let cash = 0;
                let totalBank = 0;
                let loanBalance = 0;

                // Calculate cash position
                sales.forEach(sale => {
                    if (sale.paymentMethod === 'Cash') cash += sale.total || 0;
                });

                purchases.forEach(purchase => {
                    if (purchase.paymentMethod === 'Cash') cash -= purchase.total || 0;
                });

                expenses.forEach(expense => {
                    if (expense.paymentMethod === 'Cash') cash -= expense.amount || 0;
                });

                loans.forEach(loan => {
                    if (loan.type === 'Disbursement') {
                        cash += loan.amount || 0;
                        loanBalance += loan.amount || 0;
                    } else if (loan.type === 'Repayment') {
                        cash -= loan.amount || 0;
                        loanBalance -= loan.amount || 0;
                    }
                });

                // Calculate bank balances
                bankAccounts.forEach(account => {
                    totalBank += account.initialBalance || 0;
                });

                // Process transfers
                transfers.forEach(transfer => {
                    if (transfer.from === 'Cash') cash -= transfer.amount || 0;
                    if (transfer.to === 'Cash') cash += transfer.amount || 0;
                    // Bank transfers are handled in banking module
                });

                // Calculate payables and receivables
                let totalPayables = 0;
                let totalReceivables = 0;

                purchases.forEach(purchase => {
                    if (purchase.paymentMethod === 'Credit') {
                        const paid = payments.filter(p => p.invoiceId === purchase.id && p.type === 'payable')
                            .reduce((sum, p) => sum + (p.amount || 0), 0);
                        totalPayables += Math.max(0, (purchase.total || 0) - paid);
                    }
                });

                sales.forEach(sale => {
                    if (sale.paymentMethod === 'Credit') {
                        const received = payments.filter(p => p.invoiceId === sale.id && p.type === 'receivable')
                            .reduce((sum, p) => sum + (p.amount || 0), 0);
                        totalReceivables += Math.max(0, (sale.total || 0) - received);
                    }
                });

                // Update UI
                document.getElementById('cashChip').innerHTML = `<strong>Cash:</strong> ${utils.formatCurrency(cash)}`;
                document.getElementById('bankChip').innerHTML = `<strong>Bank:</strong> ${utils.formatCurrency(totalBank)}`;
                document.getElementById('payablesChip').innerHTML = `<strong>Payables:</strong> ${utils.formatCurrency(totalPayables)}`;
                document.getElementById('receivablesChip').innerHTML = `<strong>Receivables:</strong> ${utils.formatCurrency(totalReceivables)}`;

            } catch (error) {
                console.error('Error updating summary chips:', error);
            }
        }

        async function updateDashboardStats() {
            try {
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                const lastMonth = currentMonth === 0 ? 11 : currentMonth - 1;
                const lastMonthYear = currentMonth === 0 ? currentYear - 1 : currentYear;

                const [sales, purchases, inventory] = await Promise.all([
                    db.getAll('sales'),
                    db.getAll('purchases'),
                    db.getAll('inventory')
                ]);

                // Current month data
                const currentMonthSales = sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate.getMonth() === currentMonth && saleDate.getFullYear() === currentYear;
                });

                const currentMonthPurchases = purchases.filter(purchase => {
                    const purchaseDate = new Date(purchase.date);
                    return purchaseDate.getMonth() === currentMonth && purchaseDate.getFullYear() === currentYear;
                });

                // Last month data for comparison
                const lastMonthSales = sales.filter(sale => {
                    const saleDate = new Date(sale.date);
                    return saleDate.getMonth() === lastMonth && saleDate.getFullYear() === lastMonthYear;
                });

                const lastMonthPurchases = purchases.filter(purchase => {
                    const purchaseDate = new Date(purchase.date);
                    return purchaseDate.getMonth() === lastMonth && purchaseDate.getFullYear() === lastMonthYear;
                });

                // Calculate totals
                const totalSales = currentMonthSales.reduce((sum, sale) => sum + (sale.total || 0), 0);
                const totalPurchases = currentMonthPurchases.reduce((sum, purchase) => sum + (purchase.total || 0), 0);
                const profit = totalSales - totalPurchases;

                const lastMonthSalesTotal = lastMonthSales.reduce((sum, sale) => sum + (sale.total || 0), 0);
                const lastMonthPurchasesTotal = lastMonthPurchases.reduce((sum, purchase) => sum + (purchase.total || 0), 0);
                const lastMonthProfit = lastMonthSalesTotal - lastMonthPurchasesTotal;

                // Calculate percentage changes
                const salesChange = utils.calculatePercentageChange(totalSales, lastMonthSalesTotal);
                const purchasesChange = utils.calculatePercentageChange(totalPurchases, lastMonthPurchasesTotal);
                const profitChange = utils.calculatePercentageChange(profit, lastMonthProfit);

                // Low stock items
                const lowStockItems = inventory.filter(item => (item.stock || 0) <= (item.minStock || 0)).length;

                // Update UI
                document.getElementById('totalSales').textContent = utils.formatCurrency(totalSales);
                document.getElementById('totalPurchases').textContent = utils.formatCurrency(totalPurchases);
                document.getElementById('profit').textContent = utils.formatCurrency(profit);
                document.getElementById('lowStockItems').textContent = lowStockItems;

                // Update change indicators
                const salesChangeEl = document.getElementById('salesChange');
                const purchasesChangeEl = document.getElementById('purchasesChange');
                const profitChangeEl = document.getElementById('profitChange');

                if (salesChangeEl) {
                    const icon = salesChange >= 0 ? '↗️' : '↘️';
                    const sign = salesChange >= 0 ? '+' : '';
                    salesChangeEl.innerHTML = `<span>${icon}</span> ${sign}${salesChange.toFixed(1)}% from last month`;
                    salesChangeEl.className = `stat-change ${salesChange >= 0 ? 'positive' : 'negative'}`;
                }

                if (purchasesChangeEl) {
                    const icon = purchasesChange >= 0 ? '↗️' : '↘️';
                    const sign = purchasesChange >= 0 ? '+' : '';
                    purchasesChangeEl.innerHTML = `<span>${icon}</span> ${sign}${purchasesChange.toFixed(1)}% from last month`;
                    purchasesChangeEl.className = `stat-change ${purchasesChange >= 0 ? 'positive' : 'negative'}`;
                }

                if (profitChangeEl) {
                    const icon = profitChange >= 0 ? '↗️' : '↘️';
                    const sign = profitChange >= 0 ? '+' : '';
                    profitChangeEl.innerHTML = `<span>${icon}</span> ${sign}${profitChange.toFixed(1)}% from last month`;
                    profitChangeEl.className = `stat-change ${profitChange >= 0 ? 'positive' : 'negative'}`;
                }

            } catch (error) {
                console.error('Error updating dashboard stats:', error);
            }
        }

        async function loadRecentTransactions() {
            try {
                const [sales, purchases, expenses] = await Promise.all([
                    db.getAll('sales'),
                    db.getAll('purchases'),
                    db.getAll('expenses')
                ]);

                const allTransactions = [
                    ...sales.map(s => ({ 
                        ...s, 
                        type: 'Sale', 
                        description: `Sale to ${s.customer}`,
                        amount: s.total,
                        icon: '💰'
                    })),
                    ...purchases.map(p => ({ 
                        ...p, 
                        type: 'Purchase', 
                        description: `Purchase from ${p.supplier}`, 
                        amount: p.total,
                        icon: '🛒'
                    })),
                    ...expenses.map(e => ({ 
                        ...e, 
                        type: 'Expense', 
                        description: e.description, 
                        amount: e.amount,
                        icon: '💸'
                    }))
                ];

                allTransactions.sort((a, b) => new Date(b.date) - new Date(a.date));
                const recent = allTransactions.slice(0, 10);

                const tbody = document.getElementById('recentTransactions');
                if (recent.length === 0) {
                    tbody.innerHTML = `
                        <tr class="no-hover">
                            <td colspan="6" style="text-align: center; color: var(--text-secondary); padding: 3rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">📊</div>
                                <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">No transactions yet</div>
                                <div>Click "Load Demo Data" to get started with sample data</div>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = recent.map(t => `
                        <tr>
                            <td>${utils.formatDate(t.date)}</td>
                            <td>
                                <span style="display: flex; align-items: center; gap: 0.5rem;">
                                    <span>${t.icon}</span>
                                    ${t.type}
                                </span>
                            </td>
                            <td>${t.description}</td>
                            <td><strong>${utils.formatCurrency(t.amount)}</strong></td>
                            <td>
                                <span class="status-badge ${t.paymentMethod === 'Credit' ? 'status-pending' : 'status-paid'}">
                                    ${t.paymentMethod || 'Paid'}
                                </span>
                            </td>
                            <td>
                                <button class="btn sm" onclick="viewTransaction('${t.type.toLowerCase()}', ${t.id})">
                                    View
                                </button>
                            </td>
                        </tr>
                    `).join('');
                }
            } catch (error) {
                console.error('Error loading recent transactions:', error);
            }
        }

        // Inventory Management Functions
        async function loadInventory() {
            try {
                const inventory = await db.getAll('inventory');
                const tbody = document.getElementById('inventoryTable');
                
                if (inventory.length === 0) {
                    tbody.innerHTML = `
                        <tr class="no-hover">
                            <td colspan="9" style="text-align: center; color: var(--text-secondary); padding: 3rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">📦</div>
                                <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">No inventory items</div>
                                <div>Add your first inventory item to get started</div>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = inventory.map(item => {
                        const stock = item.stock || 0;
                        const minStock = item.minStock || 0;
                        const value = stock * (item.costPrice || 0);
                        const isLowStock = stock <= minStock && minStock > 0;
                        const isOutOfStock = stock === 0;
                        
                        let stockDisplay = stock.toString();
                        if (isOutOfStock) {
                            stockDisplay = `<span style="color: var(--danger); font-weight: bold;">0 ❌</span>`;
                        } else if (isLowStock) {
                            stockDisplay = `<span style="color: var(--warning); font-weight: bold;">${stock} ⚠️</span>`;
                        } else {
                            stockDisplay = `<span style="color: var(--success); font-weight: bold;">${stock} ✅</span>`;
                        }
                        
                        return `
                            <tr>
                                <td><input type="checkbox" class="inventory-checkbox" value="${item.id}"></td>
                                <td><code>${item.sku}</code></td>
                                <td><strong>${item.name}</strong></td>
                                <td><span class="status-badge status-draft">${item.category}</span></td>
                                <td>${stockDisplay}</td>
                                <td>${utils.formatCurrency(item.costPrice)}</td>
                                <td>${utils.formatCurrency(item.sellingPrice)}</td>
                                <td><strong>${utils.formatCurrency(value)}</strong></td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn sm" onclick="viewInventoryItem(${item.id})" title="View Details">
                                            👁️
                                        </button>
                                        <button class="btn sm info" onclick="editInventoryItem(${item.id})" title="Edit Item">
                                            ✏️
                                        </button>
                                        <button class="btn sm warning" onclick="adjustStock(${item.id})" title="Adjust Stock">
                                            🔢
                                        </button>
                                        <button class="btn sm danger" onclick="deleteInventoryItem(${item.id})" title="Delete Item">
                                            🗑️
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
                // Update category filter
                await updateCategoryFilter(inventory);
                
            } catch (error) {
                console.error('Error loading inventory:', error);
                showToast('Error loading inventory data', 'error');
            }
        }

        async function updateCategoryFilter(inventory = null) {
            if (!inventory) {
                inventory = await db.getAll('inventory');
            }
            
            const categories = [...new Set(inventory.map(item => item.category).filter(Boolean))];
            const categoryFilter = document.getElementById('categoryFilter');
            
            if (categoryFilter) {
                const currentValue = categoryFilter.value;
                categoryFilter.innerHTML = '<option value="">All Categories</option>' + 
                    categories.map(cat => `<option value="${cat}">${cat}</option>`).join('');
                categoryFilter.value = currentValue;
            }
        }

        function showInventoryModal() {
            document.getElementById('inventoryModalTitle').textContent = 'Add Inventory Item';
            loadInventoryCategories();
            showModal('inventoryModal');
            // Set current date as default
            setTimeout(() => {
                document.getElementById('itemSku').focus();
            }, 300);
        }

        async function loadInventoryCategories() {
            try {
                const settings = await db.getAll('settings');
                const categoriesSetting = settings.find(s => s.key === 'inventoryCategories');
                const categorySelect = document.getElementById('itemCategory');
                
                let categories = ['Shirts', 'Pants', 'Accessories', 'Electronics', 'Books']; // Default categories
                
                if (categoriesSetting && categoriesSetting.value) {
                    categories = categoriesSetting.value.split('\n').filter(c => c.trim());
                }
                
                categorySelect.innerHTML = '<option value="">Select Category</option>' + 
                    categories.map(cat => `<option value="${cat.trim()}">${cat.trim()}</option>`).join('');
                    
            } catch (error) {
                console.error('Error loading categories:', error);
            }
        }

        async function viewInventoryItem(id) {
            try {
                const item = await db.get('inventory', id);
                if (!item) {
                    showToast('Item not found', 'error');
                    return;
                }
                
                const value = (item.stock || 0) * (item.costPrice || 0);
                const profit = (item.sellingPrice || 0) - (item.costPrice || 0);
                const profitMargin = item.costPrice ? ((profit / item.costPrice) * 100).toFixed(1) : 0;
                
                const details = `
📦 INVENTORY ITEM DETAILS

🏷️ SKU: ${item.sku}
📝 Name: ${item.name}
📂 Category: ${item.category}
📊 Stock: ${item.stock || 0} units
⚠️ Min Stock: ${item.minStock || 0} units
💰 Cost Price: ${utils.formatCurrency(item.costPrice)}
💵 Selling Price: ${utils.formatCurrency(item.sellingPrice)}
📈 Profit per Unit: ${utils.formatCurrency(profit)}
📊 Profit Margin: ${profitMargin}%
💎 Total Value: ${utils.formatCurrency(value)}
📅 Created: ${utils.formatDate(item.createdAt)}
🔄 Last Updated: ${utils.formatDate(item.updatedAt)}
${item.description ? `\n📄 Description: ${item.description}` : ''}
                `;
                
                alert(details);
                
            } catch (error) {
                console.error('Error viewing item:', error);
                showToast('Error loading item details', 'error');
            }
        }

        async function editInventoryItem(id) {
            try {
                const item = await db.get('inventory', id);
                if (!item) {
                    showToast('Item not found', 'error');
                    return;
                }
                
                appState.editingItem = item;
                document.getElementById('inventoryModalTitle').textContent = 'Edit Inventory Item';
                
                // Populate form
                document.getElementById('itemSku').value = item.sku || '';
                document.getElementById('itemName').value = item.name || '';
                document.getElementById('itemCategory').value = item.category || '';
                document.getElementById('itemMinStock').value = item.minStock || '';
                document.getElementById('itemCostPrice').value = item.costPrice || '';
                document.getElementById('itemSellingPrice').value = item.sellingPrice || '';
                document.getElementById('itemStock').value = item.stock || '';
                document.getElementById('itemUnit').value = item.unit || 'pcs';
                document.getElementById('itemDescription').value = item.description || '';
                
                await loadInventoryCategories();
                document.getElementById('itemCategory').value = item.category || '';
                
                showModal('inventoryModal');
                
            } catch (error) {
                console.error('Error editing item:', error);
                showToast('Error loading item for editing', 'error');
            }
        }

        async function deleteInventoryItem(id) {
            if (!confirm('⚠️ Are you sure you want to delete this inventory item?\n\nThis action cannot be undone.')) {
                return;
            }
            
            try {
                await db.delete('inventory', id);
                await loadInventory();
                showToast('Inventory item deleted successfully', 'success');
            } catch (error) {
                console.error('Error deleting item:', error);
                showToast('Error deleting inventory item', 'error');
            }
        }

        async function adjustStock(id) {
            try {
                const item = await db.get('inventory', id);
                if (!item) {
                    showToast('Item not found', 'error');
                    return;
                }
                
                const currentStock = item.stock || 0;
                const adjustment = prompt(`📦 ${item.name}\n\nCurrent stock: ${currentStock} units\n\nEnter adjustment (+/- number):\n\nExamples:\n+50 (add 50 units)\n-20 (remove 20 units)`);
                
                if (adjustment === null) return; // User cancelled
                
                const adjustmentNum = parseFloat(adjustment);
                if (isNaN(adjustmentNum)) {
                    showToast('Please enter a valid number', 'error');
                    return;
                }
                
                const newStock = Math.max(0, currentStock + adjustmentNum);
                item.stock = newStock;
                
                await db.update('inventory', item);
                await loadInventory();
                
                const changeText = adjustmentNum > 0 ? `Added ${adjustmentNum}` : `Removed ${Math.abs(adjustmentNum)}`;
                showToast(`${changeText} units. New stock: ${newStock}`, 'success');
                
            } catch (error) {
                console.error('Error adjusting stock:', error);
                showToast('Error adjusting stock', 'error');
            }
        }

        function refreshInventory() {
            loadInventory();
            showToast('Inventory refreshed', 'info');
        }

        function toggleSelectAllInventory() {
            const selectAll = document.getElementById('selectAllInventory');
            const checkboxes = document.querySelectorAll('.inventory-checkbox');
            
            checkboxes.forEach(cb => {
                cb.checked = selectAll.checked;
            });
        }

        // Sales Management Functions
        async function loadSales() {
            try {
                const [sales, payments, attachments] = await Promise.all([
                    db.getAll('sales'),
                    db.getAll('payments'),
                    db.getAll('attachments')
                ]);

                const tbody = document.getElementById('salesTable');
                
                if (sales.length === 0) {
                    tbody.innerHTML = `
                        <tr class="no-hover">
                            <td colspan="9" style="text-align: center; color: var(--text-secondary); padding: 3rem;">
                                <div style="font-size: 3rem; margin-bottom: 1rem;">💰</div>
                                <div style="font-weight: 600; font-size: 1.125rem; margin-bottom: 0.5rem;">No sales recorded</div>
                                <div>Create your first sale to start tracking revenue</div>
                            </td>
                        </tr>
                    `;
                } else {
                    tbody.innerHTML = sales.map(sale => {
                        // Calculate payment status
                        const salePayments = payments.filter(p => p.invoiceId === sale.id && p.type === 'receivable');
                        const paidAmount = salePayments.reduce((sum, p) => sum + (p.amount || 0), 0);
                        const outstanding = (sale.total || 0) - paidAmount;
                        
                        let status = 'Paid';
                        let statusClass = 'status-paid';
                        
                        if (sale.paymentMethod === 'Credit') {
                            if (outstanding > 0) {
                                const dueDate = new Date(sale.date);
                                dueDate.setDate(dueDate.getDate() + 30); // 30 days credit terms
                                const isOverdue = new Date() > dueDate;
                                
                                status = isOverdue ? 'Overdue' : 'Pending';
                                statusClass = isOverdue ? 'status-overdue' : 'status-pending';
                            }
                        }
                        
                        // Check for attachments
                        const saleAttachment = attachments.find(a => a.invoiceId === sale.id);
                        let imageCell = '<span style="color: var(--text-secondary);">-</span>';
                        
                        if (saleAttachment) {
                            if (saleAttachment.type && saleAttachment.type.startsWith('image/')) {
                                imageCell = `<img src="${saleAttachment.data}" class="attachment-preview" onclick="showImageViewer('${saleAttachment.data}')" title="Click to view full size">`;
                            } else {
                                imageCell = `<span style="color: var(--info); cursor: pointer;" onclick="downloadAttachment(${saleAttachment.id})" title="Download ${saleAttachment.name}">📄</span>`;
                            }
                        }
                        
                        return `
                            <tr>
                                <td><code>${sale.invoiceNumber}</code></td>
                                <td>${utils.formatDate(sale.date)}</td>
                                <td><strong>${sale.customer}</strong></td>
                                <td><span class="status-badge status-draft">${sale.items ? sale.items.length : 0} items</span></td>
                                <td><strong>${utils.formatCurrency(sale.total)}</strong></td>
                                <td>
                                    <span class="status-badge status-draft">
                                        ${getPaymentIcon(sale.paymentMethod)} ${sale.paymentMethod}
                                    </span>
                                </td>
                                <td><span class="status-badge ${statusClass}">${status}</span></td>
                                <td>${imageCell}</td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn sm" onclick="viewSale(${sale.id})" title="View Details">
                                            👁️
                                        </button>
                                        <button class="btn sm info" onclick="editSale(${sale.id})" title="Edit Sale">
                                            ✏️
                                        </button>
                                        <button class="btn sm warning" onclick="printInvoice(${sale.id})" title="Print Invoice">
                                            🖨️
                                        </button>
                                        <button class="btn sm danger" onclick="deleteSale(${sale.id})" title="Delete Sale">
                                            🗑️
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `;
                    }).join('');
                }
                
            } catch (error) {
                console.error('Error loading sales:', error);
                showToast('Error loading sales data', 'error');
            }
        }

        function getPaymentIcon(paymentMethod) {
            const icons = {
                'Cash': '💵',
                'Bank': '🏦',
                'Credit': '📝',
                'Card': '💳'
            };
            return icons[paymentMethod] || '💰';
        }

        function showSalesModal() {
            document.getElementById('salesModalTitle').textContent = 'New Sale';
            loadSaleItems();
            loadCustomersList();
            
            // Set default date
            document.getElementById('saleDate').value = new Date().toISOString().split('T')[0];
            
            showModal('salesModal');
        }

        async function loadSaleItems() {
            try {
                const inventory = await db.getAll('inventory');
                const selects = document.querySelectorAll('.sale-item-select');
                
                const options = '<option value="">Select Item</option>' + 
                    inventory.filter(item => (item.stock || 0) > 0)
                        .map(item => `<option value="${item.id}" data-price="${item.sellingPrice}" data-stock="${item.stock}">
                            ${item.name} (${item.sku}) - Stock: ${item.stock} - ${utils.formatCurrency(item.sellingPrice)}
                        </option>`).join('');
                
                selects.forEach(select => {
                    select.innerHTML = options;
                    // Add event listener for price auto-fill
                    select.addEventListener('change', function() {
                        const option = this.selectedOptions[0];
                        if (option && option.dataset.price) {
                            const priceInput = this.closest('.sale-item-row').querySelector('.sale-price');
                            if (priceInput) {
                                priceInput.value = option.dataset.price;
                                calculateSaleItemTotal(this.closest('.sale-item-row'));
                            }
                        }
                    });
                });
                
            } catch (error) {
                console.error('Error loading sale items:', error);
            }
        }

        async function loadCustomersList() {
            try {
                const settings = await db.getAll('settings');
                const customersSetting = settings.find(s => s.key === 'customersList');
                const customersDatalist = document.getElementById('customersDatalist');
                
                let customers = ['John Doe', 'Jane Smith', 'Walk-in Customer']; // Default customers
                
                if (customersSetting && customersSetting.value) {
                    customers = customersSetting.value.split('\n').filter(c => c.trim());
                }
                
                // Also add customers from existing sales
                const sales = await db.getAll('sales');
                const existingCustomers = [...new Set(sales.map(s => s.customer).filter(Boolean))];
                customers = [...new Set([...customers, ...existingCustomers])];
                
                if (customersDatalist) {
                    customersDatalist.innerHTML = customers.map(customer => 
                        `<option value="${customer.trim()}">`
                    ).join('');
                }
                
            } catch (error) {
                console.error('Error loading customers:', error);
            }
        }

        function addSaleItem() {
            const container = document.getElementById('saleItems');
            const newRow = document.createElement('div');
            newRow.className = 'sale-item-row';
            newRow.style.cssText = 'display: flex; gap: 1rem; margin-bottom: 1rem; align-items: end;';
            
            newRow.innerHTML = `
                <div style="flex: 2;">
                    <select class="form-input sale-item-select" required>
                        <option value="">Select Item</option>
                    </select>
                </div>
                <div style="flex: 1;">
                    <input type="number" class="form-input sale-qty" placeholder="1" min="1" required oninput="calculateSaleItemTotal(this.closest('.sale-item-row'))">
                </div>
                <div style="flex: 1;">
                    <input type="number" class="form-input sale-price" placeholder="0.00" min="0" step="0.01" required oninput="calculateSaleItemTotal(this.closest('.sale-item-row'))">
                </div>
                <div style="flex: 1;">
                    <input type="text" class="form-input sale-item-total" readonly placeholder="0.00">
                </div>
                <button type="button" class="btn danger" onclick="removeSaleItem(this)">
                    <span>🗑️</span>
                </button>
            `;
            
            container.appendChild(newRow);
            loadSaleItems();
        }

        function removeSaleItem(button) {
            button.closest('.sale-item-row').remove();
            calculateSaleTotal();
        }

        function calculateSaleItemTotal(row) {
            const qty = parseFloat(row.querySelector('.sale-qty').value) || 0;
            const price = parseFloat(row.querySelector('.sale-price').value) || 0;
            const total = qty * price;
            
            row.querySelector('.sale-item-total').value = total.toFixed(2);
            calculateSaleTotal();
        }

        function calculateSaleTotal() {
            const itemTotals = document.querySelectorAll('.sale-item-total');
            let subtotal = 0;
            
            itemTotals.forEach(input => {
                subtotal += parseFloat(input.value) || 0;
            });
            
            const discount = parseFloat(document.getElementById('saleDiscount').value) || 0;
            const shipping = parseFloat(document.getElementById('saleShipping').value) || 0;
            const total = subtotal - discount + shipping;
            
            document.getElementById('saleSubtotal').value = subtotal.toFixed(2);
            document.getElementById('saleTotal').value = total.toFixed(2);
        }

        async function viewSale(id) {
            try {
                const sale = await db.get('sales', id);
                if (!sale) {
                    showToast('Sale not found', 'error');
                    return;
                }
                
                const itemsList = sale.items ? sale.items.map(item => 
                    `• ${item.name} (${item.sku}) - Qty: ${item.qty} @ ${utils.formatCurrency(item.price)} = ${utils.formatCurrency(item.total)}`
                ).join('\n') : 'No items';
                
                const details = `
💰 SALE DETAILS

🧾 Invoice: ${sale.invoiceNumber}
👤 Customer: ${sale.customer}
📅 Date: ${utils.formatDate(sale.date)}
💳 Payment: ${sale.paymentMethod}

📦 ITEMS:
${itemsList}

💵 FINANCIAL SUMMARY:
Subtotal: ${utils.formatCurrency(sale.subtotal)}
Discount: ${utils.formatCurrency(sale.discount || 0)}
Shipping: ${utils.formatCurrency(sale.shipping || 0)}
TOTAL: ${utils.formatCurrency(sale.total)}

${sale.notes ? `\n📝 Notes: ${sale.notes}` : ''}
                `;
                
                alert(details);
                
            } catch (error) {
                console.error('Error viewing sale:', error);
                showToast('Error loading sale details', 'error');
            }
        }

        async function editSale(id) {
            try {
                const sale = await db.get('sales', id);
                if (!sale) {
                    showToast('Sale not found', 'error');
                    return;
                }
                
                appState.editingItem = sale;
                document.getElementById('salesModalTitle').textContent = 'Edit Sale';
                
                // Populate form
                document.getElementById('saleCustomer').value = sale.customer || '';
                document.getElementById('saleDate').value = sale.date || '';
                document.getElementById('saleDiscount').value = sale.discount || 0;
                document.getElementById('saleShipping').value = sale.shipping || 0;
                document.getElementById('salePaymentMethod').value = sale.paymentMethod || '';
                document.getElementById('saleNotes').value = sale.notes || '';
                
                // Clear existing items and populate
                const container = document.getElementById('saleItems');
                container.innerHTML = '';
                
                if (sale.items && sale.items.length > 0) {
                    sale.items.forEach((item, index) => {
                        if (index === 0) {
                            // Add first row
                            addSaleItem();
                        } else {
                            addSaleItem();
                        }
                    });
                    
                    // Wait for items to load, then populate
                    setTimeout(() => {
                        const rows = document.querySelectorAll('.sale-item-row');
                        sale.items.forEach((item, index) => {
                            if (rows[index]) {
                                const row = rows[index];
                                row.querySelector('.sale-item-select').value = item.itemId;
                                row.querySelector('.sale-qty').value = item.qty;
                                row.querySelector('.sale-price').value = item.price;
                                calculateSaleItemTotal(row);
                            }
                        });
                    }, 500);
                } else {
                    addSaleItem();
                }
                
                await loadSaleItems();
                await loadCustomersList();
                
                showModal('salesModal');
                
            } catch (error) {
                console.error('Error editing sale:', error);
                showToast('Error loading sale for editing', 'error');
            }
        }

        async function deleteSale(id) {
            if (!confirm('⚠️ Are you sure you want to delete this sale?\n\nThis action cannot be undone and will affect your financial records.')) {
                return;
            }
            
            try {
                // Get sale details for inventory adjustment
                const sale = await db.get('sales', id);
                
                // Delete the sale
                await db.delete('sales', id);
                
                // Restore inventory if needed (optional - depends on business logic)
                if (sale && sale.items) {
                    for (const item of sale.items) {
                        try {
                            const inventoryItem = await db.get('inventory', item.itemId);
                            if (inventoryItem) {
                                inventoryItem.stock = (inventoryItem.stock || 0) + (item.qty || 0);
                                await db.update('inventory', inventoryItem);
                            }
                        } catch (error) {
                            console.warn('Could not restore inventory for item:', item.itemId);
                        }
                    }
                }
                
                await loadSales();
                await updateSummaryChips();
                showToast('Sale deleted successfully', 'success');
                
            } catch (error) {
                console.error('Error deleting sale:', error);
                showToast('Error deleting sale', 'error');
            }
        }

        async function printInvoice(id) {
            try {
                const sale = await db.get('sales', id);
                if (!sale) {
                    showToast('Sale not found', 'error');
                    return;
                }
                
                const settings = await db.getAll('settings');
                const businessSettings = {};
                settings.forEach(s => businessSettings[s.key] = s.value);
                
                const printWindow = window.open('', '_blank');
                
                const itemsTable = sale.items ? sale.items.map(item => `
                    <tr>
                        <td style="border: 1px solid #ddd; padding: 8px;">${item.name}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: center;">${item.qty}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">${utils.formatCurrency(item.price)}</td>
                        <td style="border: 1px solid #ddd; padding: 8px; text-align: right;">${utils.formatCurrency(item.total)}</td>
                    </tr>
                `).join('') : '<tr><td colspan="4" style="text-align: center; padding: 20px;">No items</td></tr>';
                
                const printContent = `
                    <!DOCTYPE html>
                    <html>
                    <head>
                        <title>Invoice ${sale.invoiceNumber}</title>
                        <style>
                            body { 
                                font-family: Arial, sans-serif; 
                                margin: 20px; 
                                color: #333;
                                line-height: 1.6;
                            }
                            .header { 
                                text-align: center; 
                                margin-bottom: 40px; 
                                border-bottom: 3px solid #667eea;
                                padding-bottom: 20px;
                            }
                            .company-name {
                                font-size: 2.5em;
                                font-weight: bold;
                                color: #667eea;
                                margin-bottom: 10px;
                            }
                            .invoice-title {
                                font-size: 1.8em;
                                color: #333;
                                background: #f8f9fa;
                                padding: 10px;
                                border-radius: 5px;
                            }
                            .invoice-details { 
                                display: flex;
                                justify-content: space-between;
                                margin: 30px 0; 
                            }
                            .detail-section {
                                flex: 1;
                                margin: 0 10px;
                            }
                            .detail-section h3 {
                                color: #667eea;
                                border-bottom: 2px solid #eee;
                                padding-bottom: 5px;
                            }
                            table { 
                                width: 100%; 
                                border-collapse: collapse; 
                                margin: 30px 0; 
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            }
                            th { 
                                background: #667eea; 
                                color: white;
                                padding: 12px;
                                text-align: left;
                                font-weight: bold;
                            }
                            td {
                                border: 1px solid #ddd; 
                                padding: 10px;
                            }
                            tr:nth-child(even) {
                                background: #f8f9fa;
                            }
                            .total-section {
                                background: #f8f9fa;
                                padding: 20px;
                                border-radius: 5px;
                                margin-top: 20px;
                            }
                            .total-row { 
                                font-weight: bold; 
                                font-size: 1.2em;
                                background: #667eea !important;
                                color: white;
                            }
                            .footer {
                                margin-top: 40px;
                                text-align: center;
                                color: #666;
                                border-top: 1px solid #eee;
                                padding-top: 20px;
                            }
                            @media print {
                                body { margin: 0; }
                                .no-print { display: none; }
                            }
                        </style>
                    </head>
                    <body>
                        <div class="header">
                            <div class="company-name">${businessSettings.businessName || 'Business Manager Pro'}</div>
                            ${businessSettings.businessAddress ? `<p>${businessSettings.businessAddress}</p>` : ''}
                            ${businessSettings.businessPhone ? `<p>Phone: ${businessSettings.businessPhone}</p>` : ''}
                            ${businessSettings.businessEmail ? `<p>Email: ${businessSettings.businessEmail}</p>` : ''}
                            <div class="invoice-title">SALES INVOICE</div>
                        </div>
                        
                        <div class="invoice-details">
                            <div class="detail-section">
                                <h3>Invoice Details</h3>
                                <p><strong>Invoice #:</strong> ${sale.invoiceNumber}</p>
                                <p><strong>Date:</strong> ${utils.formatDate(sale.date)}</p>
                                <p><strong>Payment Method:</strong> ${sale.paymentMethod}</p>
                            </div>
                            <div class="detail-section">
                                <h3>Customer Details</h3>
                                <p><strong>Customer:</strong> ${sale.customer}</p>
                                <p><strong>Date of Sale:</strong> ${utils.formatDate(sale.date)}</p>
                            </div>
                        </div>
                        
                        <table>
                            <thead>
                                <tr>
                                    <th>Item Description</th>
                                    <th style="text-align: center;">Quantity</th>
                                    <th style="text-align: right;">Unit Price</th>
                                    <th style="text-align: right;">Total</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${itemsTable}
                            </tbody>
                        </table>
                        
                        <div class="total-section">
                            <table style="width: 300px; margin-left: auto; box-shadow: none;">
                                <tr><td style="border: none; padding: 5px;"><strong>Subtotal:</strong></td><td style="border: none; padding: 5px; text-align: right;"><strong>${utils.formatCurrency(sale.subtotal)}</strong></td></tr>
                                ${sale.discount ? `<tr><td style="border: none; padding: 5px;">Discount:</td><td style="border: none; padding: 5px; text-align: right;">${utils.formatCurrency(sale.discount)}</td></tr>` : ''}
                                ${sale.shipping ? `<tr><td style="border: none; padding: 5px;">Shipping:</td><td style="border: none; padding: 5px; text-align: right;">${utils.formatCurrency(sale.shipping)}</td></tr>` : ''}
                                <tr class="total-row"><td style="border: none; padding: 10px;"><strong>TOTAL AMOUNT:</strong></td><td style="border: none; padding: 10px; text-align: right;"><strong>${utils.formatCurrency(sale.total)}</strong></td></tr>
                            </table>
                        </div>
                        
                        ${sale.notes ? `
                            <div style="margin-top: 30px;">
                                <h3 style="color: #667eea;">Notes:</h3>
                                <p style="background: #f8f9fa; padding: 15px; border-radius: 5px;">${sale.notes}</p>
                            </div>
                        ` : ''}
                        
                        <div class="footer">
                            <p>Thank you for your business!</p>
                            <p style="font-size: 0.9em;">Generated on ${utils.formatDate(new Date(), 'long')}</p>
                        </div>
                        
                        <div class="no-print" style="margin-top: 30px; text-align: center;">
                            <button onclick="window.print()" style="background: #667eea; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px;">🖨️ Print Invoice</button>
                            <button onclick="window.close()" style="background: #6c757d; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-size: 16px; margin-left: 10px;">✖️ Close</button>
                        </div>
                    </body>
                    </html>
                `;
                
                printWindow.document.write(printContent);
                printWindow.document.close();
                
                // Auto-print after a short delay
                setTimeout(() => {
                    printWindow.print();
                }, 1000);
                
            } catch (error) {
                console.error('Error printing invoice:', error);
                showToast('Error generating invoice', 'error');
            }
        }

        // File handling functions
        function handleFilePreview(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            const file = input.files[0];
            
            if (!file) {
                preview.innerHTML = '';
                return;
            }
            
            // Validate file size (5MB limit)
            if (file.size > 5 * 1024 * 1024) {
                showToast('File size must be less than 5MB', 'error');
                input.value = '';
                return;
            }
            
            // Validate file type
            const allowedTypes = ['image/jpeg', 'image/png', 'image/gif', 'application/pdf'];
            if (!allowedTypes.includes(file.type)) {
                showToast('Only JPG, PNG, GIF, and PDF files are allowed', 'error');
                input.value = '';
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const previewElement = document.createElement('div');
                previewElement.style.cssText = 'position: relative; display: inline-block; margin: 0.5rem;';
                
                if (file.type.startsWith('image/')) {
                    previewElement.innerHTML = `
                        <img src="${e.target.result}" class="attachment-preview" onclick="showImageViewer('${e.target.result}')" title="Click to view full size">
                        <button type="button" onclick="this.parentElement.remove(); document.getElementById('${inputId}').value = '';" 
                                style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border: none; 
                                       border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer;">×</button>
                    `;
                } else {
                    previewElement.innerHTML = `
                        <div style="padding: 1rem; border: 1px solid var(--border); border-radius: var(--border-radius); background: var(--surface);">
                            <div style="font-size: 2rem; text-align: center; margin-bottom: 0.5rem;">📄</div>
                            <div style="font-size: 0.875rem; text-align: center;">${file.name}</div>
                            <button type="button" onclick="this.closest('.attachment-container').querySelector('div').remove(); document.getElementById('${inputId}').value = '';" 
                                    style="position: absolute; top: -5px; right: -5px; background: var(--danger); color: white; border: none; 
                                           border-radius: 50%; width: 20px; height: 20px; font-size: 12px; cursor: pointer;">×</button>
                        </div>
                    `;
                }
                
                preview.innerHTML = '';
                preview.appendChild(previewElement);
            };
            
            reader.readAsDataURL(file);
        }

        function showImageViewer(src) {
            const viewer = document.getElementById('imageViewer');
            const img = document.getElementById('viewerImage');
            img.src = src;
            viewer.style.display = 'flex';
        }

        function closeImageViewer() {
            document.getElementById('imageViewer').style.display = 'none';
        }

        // Form Handlers
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Initialize theme
                const savedTheme = localStorage.getItem('theme') || 'light';
                document.documentElement.setAttribute('data-theme', savedTheme);
                updateThemeButton(savedTheme);

                // Wait for database to initialize
                await db.ensureReady();
                console.log('Application initialized successfully');

                // Load initial data
                await loadDashboard();
                await loadSettings();

                // Set up navigation
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.addEventListener('click', (e) => {
                        e.preventDefault();
                        const page = item.getAttribute('data-page');
                        if (page) {
                            navigateTo(page);
                        }
                    });
                });

                // Set up form handlers
                setupFormHandlers();

                // Set default dates
                const today = new Date().toISOString().split('T')[0];
                const inputs = document.querySelectorAll('input[type="date"]');
                inputs.forEach(input => {
                    if (!input.value) {
                        input.value = today;
                    }
                });

                // Initialize responsive sidebar
                if (window.innerWidth <= 1024) {
                    document.getElementById('sidebar').classList.remove('open');
                }

                showToast('Business Manager Pro loaded successfully! 🎉', 'success');

            } catch (error) {
                console.error('Error initializing application:', error);
                showToast('Error initializing application', 'error');
            }
        });

        function setupFormHandlers() {
            // Inventory Form
            const inventoryForm = document.getElementById('inventoryForm');
            if (inventoryForm) {
                inventoryForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const formData = {
                        sku: utils.sanitizeInput(document.getElementById('itemSku').value.trim()),
                        name: utils.sanitizeInput(document.getElementById('itemName').value.trim()),
                        category: document.getElementById('itemCategory').value.trim(),
                        minStock: parseInt(document.getElementById('itemMinStock').value) || 0,
                        costPrice: parseFloat(document.getElementById('itemCostPrice').value) || 0,
                        sellingPrice: parseFloat(document.getElementById('itemSellingPrice').value) || 0,
                        stock: parseInt(document.getElementById('itemStock').value) || 0,
                        unit: document.getElementById('itemUnit').value || 'pcs',
                        description: utils.sanitizeInput(document.getElementById('itemDescription').value.trim())
                    };
                    
                    // Validation
                    if (!formData.sku || !formData.name || !formData.category) {
                        showToast('Please fill in all required fields', 'error');
                        return;
                    }
                    
                    if (formData.costPrice < 0 || formData.sellingPrice < 0 || formData.stock < 0) {
                        showToast('Prices and stock cannot be negative', 'error');
                        return;
                    }
                    
                    if (formData.sellingPrice < formData.costPrice) {
                        if (!confirm('⚠️ Selling price is lower than cost price. This will result in a loss. Continue?')) {
                            return;
                        }
                    }
                    
                    try {
                        if (appState.editingItem) {
                            formData.id = appState.editingItem.id;
                            formData.createdAt = appState.editingItem.createdAt;
                            await db.update('inventory', formData);
                            showToast('Inventory item updated successfully! ✅', 'success');
                        } else {
                            // Check for duplicate SKU
                            const existing = await db.getAll('inventory');
                            if (existing.some(item => item.sku.toLowerCase() === formData.sku.toLowerCase())) {
                                showToast('SKU already exists. Please use a different SKU.', 'error');
                                return;
                            }
                            
                            await db.add('inventory', formData);
                            showToast('Inventory item added successfully! 🎉', 'success');
                        }
                        
                        closeModal('inventoryModal');
                        await loadInventory();
                        
                    } catch (error) {
                        console.error('Error saving inventory item:', error);
                        showToast('Error saving inventory item', 'error');
                    }
                });
            }

            // Sales Form
            const salesForm = document.getElementById('salesForm');
            if (salesForm) {
                salesForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    // Collect items
                    const items = [];
                    const itemRows = document.querySelectorAll('.sale-item-row');
                    
                    for (const row of itemRows) {
                        const itemId = parseInt(row.querySelector('.sale-item-select').value);
                        const qty = parseInt(row.querySelector('.sale-qty').value);
                        const price = parseFloat(row.querySelector('.sale-price').value);
                        
                        if (itemId && qty && price && qty > 0 && price >= 0) {
                            try {
                                const item = await db.get('inventory', itemId);
                                if (!item) {
                                    showToast('Selected item not found in inventory', 'error');
                                    return;
                                }
                                
                                // Check stock availability
                                if (!appState.editingItem && (item.stock || 0) < qty) {
                                    showToast(`Insufficient stock for ${item.name}. Available: ${item.stock || 0}`, 'error');
                                    return;
                                }
                                
                                items.push({
                                    itemId,
                                    name: item.name,
                                    sku: item.sku,
                                    qty,
                                    price,
                                    total: qty * price
                                });
                            } catch (error) {
                                console.error('Error processing item:', error);
                                showToast('Error processing selected item', 'error');
                                return;
                            }
                        }
                    }
                    
                    if (items.length === 0) {
                        showToast('Please add at least one item to the sale', 'error');
                        return;
                    }
                    
                    const customer = utils.sanitizeInput(document.getElementById('saleCustomer').value.trim());
                    const paymentMethod = document.getElementById('salePaymentMethod').value;
                    
                    if (!customer || !paymentMethod) {
                        showToast('Please fill in customer name and payment method', 'error');
                        return;
                    }
                    
                    const subtotal = items.reduce((sum, item) => sum + item.total, 0);
                    const discount = parseFloat(document.getElementById('saleDiscount').value) || 0;
                    const shipping = parseFloat(document.getElementById('saleShipping').value) || 0;
                    const total = subtotal - discount + shipping;
                    
                    if (total <= 0) {
                        showToast('Sale total must be greater than zero', 'error');
                        return;
                    }
                    
                    const saleData = {
                        invoiceNumber: appState.editingItem ? appState.editingItem.invoiceNumber : utils.generateInvoiceNumber(),
                        customer,
                        date: document.getElementById('saleDate').value,
                        items,
                        subtotal,
                        discount,
                        shipping,
                        total,
                        paymentMethod,
                        notes: utils.sanitizeInput(document.getElementById('saleNotes').value.trim())
                    };
                    
                    try {
                        let saleId;
                        
                        if (appState.editingItem) {
                            saleData.id = appState.editingItem.id;
                            saleData.createdAt = appState.editingItem.createdAt;
                            await db.update('sales', saleData);
                            saleId = appState.editingItem.id;
                            showToast('Sale updated successfully! ✅', 'success');
                        } else {
                            saleId = await db.add('sales', saleData);
                            showToast('Sale recorded successfully! 🎉', 'success');
                        }
                        
                        // Handle file attachment
                        const attachmentFile = document.getElementById('saleAttachment');
                        if (attachmentFile && attachmentFile.files[0]) {
                            try {
                                const file = attachmentFile.files[0];
                                const reader = new FileReader();
                                reader.onload = async (e) => {
                                    try {
                                        const attachment = {
                                            invoiceId: saleId,
                                            name: file.name,
                                            type: file.type,
                                            size: file.size,
                                            data: e.target.result
                                        };
                                        await db.add('attachments', attachment);
                                    } catch (error) {
                                        console.error('Error saving attachment:', error);
                                    }
                                };
                                reader.readAsDataURL(file);
                            } catch (error) {
                                console.error('Error handling attachment:', error);
                            }
                        }
                        
                        // Update inventory
                        if (!appState.editingItem) { // Only adjust stock for new sales
                            for (const item of items) {
                                try {
                                    const inventoryItem = await db.get('inventory', item.itemId);
                                    if (inventoryItem) {
                                        inventoryItem.stock = Math.max(0, (inventoryItem.stock || 0) - item.qty);
                                        await db.update('inventory', inventoryItem);
                                    }
                                } catch (error) {
                                    console.warn('Could not update inventory for item:', item.itemId);
                                }
                            }
                        }
                        
                        closeModal('salesModal');
                        await loadSales();
                        await updateSummaryChips();
                        
                    } catch (error) {
                        console.error('Error saving sale:', error);
                        showToast('Error saving sale', 'error');
                    }
                });
            }
        }

        // Theme Functions
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeButton(newTheme);
            showToast(`Switched to ${newTheme} theme`, 'info');
        }

        function updateThemeButton(theme) {
            const themeIcon = document.getElementById('themeIcon');
            const themeText = document.getElementById('themeText');
            
            if (theme === 'dark') {
                themeIcon.textContent = '☀️';
                themeText.textContent = 'Light';
            } else {
                themeIcon.textContent = '🌙';
                themeText.textContent = 'Dark';
            }
        }

        // Responsive Functions
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('open');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', (e) => {
            if (window.innerWidth <= 1024) {
                const sidebar = document.getElementById('sidebar');
                const toggle = document.querySelector('.sidebar-toggle');
                
                if (!sidebar.contains(e.target) && !toggle.contains(e.target)) {
                    sidebar.classList.remove('open');
                }
            }
        });

        // Demo Data Function
        async function loadDemoData() {
            if (!confirm('🎯 This will add comprehensive demo data to your database.\n\nThis includes:\n• Sample inventory items\n• Sales transactions\n• Purchase records\n• Expense entries\n• Customer and supplier data\n\nContinue?')) {
                return;
            }
            
            try {
                showToast('Loading demo data...', 'info');
                
                // Demo Inventory Items
                const demoInventory = [
                    {
                        sku: 'SHIRT001',
                        name: 'Premium Cotton T-Shirt',
                        category: 'Shirts',
                        costPrice: 500,
                        sellingPrice: 800,
                        stock: 50,
                        minStock: 10,
                        unit: 'pcs',
                        description: 'High-quality cotton t-shirt, comfortable and durable'
                    },
                    {
                        sku: 'PANTS001',
                        name: 'Denim Jeans',
                        category: 'Pants',
                        costPrice: 1200,
                        sellingPrice: 2000,
                        stock: 30,
                        minStock: 5,
                        unit: 'pcs',
                        description: 'Classic blue denim jeans, various sizes available'
                    },
                    {
                        sku: 'ACC001',
                        name: 'Leather Belt',
                        category: 'Accessories',
                        costPrice: 300,
                        sellingPrice: 600,
                        stock: 25,
                        minStock: 5,
                        unit: 'pcs',
                        description: 'Genuine leather belt with metal buckle'
                    },
                    {
                        sku: 'SHIRT002',
                        name: 'Formal Dress Shirt',
                        category: 'Shirts',
                        costPrice: 800,
                        sellingPrice: 1400,
                        stock: 20,
                        minStock: 8,
                        unit: 'pcs',
                        description: 'Professional dress shirt for office wear'
                    },
                    {
                        sku: 'ACC002',
                        name: 'Casual Sneakers',
                        category: 'Footwear',
                        costPrice: 1500,
                        sellingPrice: 2500,
                        stock: 15,
                        minStock: 3,
                        unit: 'pairs',
                        description: 'Comfortable casual sneakers for everyday wear'
                    }
                ];
                
                for (const item of demoInventory) {
                    await db.add('inventory', item);
                }
                
                // Demo Sales
                const demoSales = [
                    {
                        invoiceNumber: utils.generateInvoiceNumber(),
                        customer: 'John Doe',
                        date: new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 5 days ago
                        items: [
                            { itemId: 1, name: 'Premium Cotton T-Shirt', sku: 'SHIRT001', qty: 2, price: 800, total: 1600 },
                            { itemId: 3, name: 'Leather Belt', sku: 'ACC001', qty: 1, price: 600, total: 600 }
                        ],
                        subtotal: 2200,
                        discount: 100,
                        shipping: 150,
                        total: 2250,
                        paymentMethod: 'Cash',
                        notes: 'Customer paid in cash, provided discount for bulk purchase'
                    },
                    {
                        invoiceNumber: utils.generateInvoiceNumber(),
                        customer: 'Jane Smith',
                        date: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 3 days ago
                        items: [
                            { itemId: 2, name: 'Denim Jeans', sku: 'PANTS001', qty: 1, price: 2000, total: 2000 }
                        ],
                        subtotal: 2000,
                        discount: 0,
                        shipping: 200,
                        total: 2200,
                        paymentMethod: 'Bank',
                        notes: 'Bank transfer completed'
                    },
                    {
                        invoiceNumber: utils.generateInvoiceNumber(),
                        customer: 'Ahmed Ali',
                        date: new Date().toISOString().split('T')[0], // Today
                        items: [
                            { itemId: 4, name: 'Formal Dress Shirt', sku: 'SHIRT002', qty: 2, price: 1400, total: 2800 },
                            { itemId: 5, name: 'Casual Sneakers', sku: 'ACC002', qty: 1, price: 2500, total: 2500 }
                        ],
                        subtotal: 5300,
                        discount: 200,
                        shipping: 0,
                        total: 5100,
                        paymentMethod: 'Credit',
                        notes: 'Corporate order, 30 days payment terms'
                    }
                ];
                
                for (const sale of demoSales) {
                    await db.add('sales', sale);
                }
                
                // Demo Purchases
                const demoPurchases = [
                    {
                        supplier: 'ABC Textiles',
                        date: new Date(Date.now() - 10 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 10 days ago
                        items: [
                            { itemId: 1, name: 'Premium Cotton T-Shirt', sku: 'SHIRT001', qty: 100, cost: 500, total: 50000 }
                        ],
                        total: 50000,
                        paymentMethod: 'Bank'
                    },
                    {
                        supplier: 'XYZ Garments',
                        date: new Date(Date.now() - 7 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 7 days ago
                        items: [
                            { itemId: 2, name: 'Denim Jeans', sku: 'PANTS001', qty: 50, cost: 1200, total: 60000 }
                        ],
                        total: 60000,
                        paymentMethod: 'Credit'
                    }
                ];
                
                for (const purchase of demoPurchases) {
                    await db.add('purchases', purchase);
                }
                
                // Demo Expenses
                const demoExpenses = [
                    {
                        date: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 2 days ago
                        category: 'Marketing',
                        description: 'Monthly SEO and digital marketing services',
                        amount: 5000,
                        paymentMethod: 'Bank',
                        party: 'Digital Marketing Agency'
                    },
                    {
                        date: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // Yesterday
                        category: 'Operations',
                        description: 'Packaging materials and shipping supplies',
                        amount: 2000,
                        paymentMethod: 'Cash',
                        party: 'Pack Supply Co.'
                    },
                    {
                        date: new Date().toISOString().split('T')[0], // Today
                        category: 'Staff',
                        description: 'Monthly staff wages',
                        amount: 15000,
                        paymentMethod: 'Bank',
                        party: 'Staff Salaries'
                    }
                ];
                
                for (const expense of demoExpenses) {
                    await db.add('expenses', expense);
                }
                
                // Demo Loan Transaction
                await db.add('loans', {
                    date: new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0], // 30 days ago
                    type: 'Disbursement',
                    amount: 100000,
                    description: 'Initial business loan from brother for inventory and working capital'
                });
                
                // Demo Settings
                const demoSettings = [
                    { key: 'businessName', value: 'Fashion Hub Store' },
                    { key: 'businessAddress', value: 'Shop #123, Main Market, Karachi, Pakistan' },
                    { key: 'businessPhone', value: '+92-XXX-XXXXXXX' },
                    { key: 'businessEmail', value: 'info@fashionhub.com' },
                    { key: 'inventoryCategories', value: 'Shirts\nPants\nAccessories\nFootwear\nJackets' },
                    { key: 'expenseCategories', value: 'Marketing\nOperations\nStaff\nUtilities\nRent\nOther' },
                    { key: 'customersList', value: 'John Doe\nJane Smith\nAhmed Ali\nSarah Khan\nWalk-in Customer' },
                    { key: 'vendorsList', value: 'ABC Textiles\nXYZ Garments\nFashion Wholesale\nLocal Supplier' }
                ];
                
                for (const setting of demoSettings) {
                    await db.add('settings', setting);
                }
                
                // Demo Bank Account
                await db.add('bankAccounts', {
                    bankName: 'HBL Bank',
                    accountTitle: 'Fashion Hub Store',
                    accountNumber: '12345678901234',
                    initialBalance: 250000
                });
                
                showToast('Demo data loaded successfully! 🎉', 'success');
                
                // Refresh current page
                await loadPageData(appState.currentPage);
                await updateSummaryChips();
                
            } catch (error) {
                console.error('Error loading demo data:', error);
                showToast('Error loading demo data', 'error');
            }
        }

        // Export Functions
        function exportInventoryCSV() {
            db.getAll('inventory').then(inventory => {
                if (inventory.length === 0) {
                    showToast('No inventory data to export', 'warning');
                    return;
                }
                
                const headers = ['SKU', 'Name', 'Category', 'Stock', 'Cost Price', 'Selling Price', 'Min Stock', 'Unit', 'Description', 'Total Value'];
                const rows = inventory.map(item => [
                    item.sku || '',
                    `"${item.name || ''}"`,
                    item.category || '',
                    item.stock || 0,
                    item.costPrice || 0,
                    item.sellingPrice || 0,
                    item.minStock || 0,
                    item.unit || 'pcs',
                    `"${item.description || ''}"`,
                    (item.stock || 0) * (item.costPrice || 0)
                ]);
                
                const csv = [headers.join(','), ...rows.map(row => row.join(','))].join('\n');
                downloadFile(csv, 'inventory-export.csv', 'text/csv');
                showToast('Inventory exported successfully!', 'success');
            }).catch(error => {
                console.error('Export error:', error);
                showToast('Error exporting inventory', 'error');
            });
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Additional utility functions will be added here...

        // Initialize notification system
        let notificationCount = 0;
        function updateNotificationCount() {
            document.getElementById('notificationCount').textContent = notificationCount;
        }

        function showNotifications() {
            showToast('Notification system coming soon!', 'info');
        }

        // Quick action functions
        function showQuickSale() {
            navigateTo('sales');
            setTimeout(() => showSalesModal(), 300);
        }

        function showQuickExpense() {
            navigateTo('expenses');
            setTimeout(() => showExpenseModal(), 300);
        }

        function showQuickInventory() {
            navigateTo('inventory');
            setTimeout(() => showInventoryModal(), 300);
        }

        // Additional functions for other modules would continue here...
        // This includes purchases, expenses, loans, banking, reports, settings, etc.
        
        // Placeholder functions for unimplemented features
        function loadAnalytics() { console.log('Analytics loading...'); }
        function loadPurchases() { console.log('Purchases loading...'); }
        function loadExpenses() { console.log('Expenses loading...'); }
        function loadLoans() { console.log('Loans loading...'); }
        function loadPayables() { console.log('Payables loading...'); }
        function loadReceivables() { console.log('Receivables loading...'); }
        function loadBanking() { console.log('Banking loading...'); }
        function loadReports() { console.log('Reports loading...'); }
        function loadSettings() { console.log('Settings loading...'); }
        function showExpenseModal() { console.log('Expense modal...'); }
        function showBackupModal() { console.log('Backup modal...'); }
        function renderDashboardCharts() { console.log('Rendering charts...'); }
        function refreshDashboard() { loadDashboard(); }
        function viewTransaction(type, id) { console.log('View transaction:', type, id); }
        function exportTransactions() { console.log('Export transactions...'); }
        function generateAnalytics() { console.log('Generate analytics...'); }
        
    </script>
</body>
</html>